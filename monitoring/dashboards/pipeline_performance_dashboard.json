{
  "name": "Pipeline Performance Dashboard",
  "description": "Monitor batch and streaming pipeline execution metrics",
  "refresh_interval": "5m",
  "widgets": [
    {
      "id": "pipeline_success_rate",
      "type": "scorecard",
      "title": "Pipeline Success Rate (24h)",
      "position": {"x": 0, "y": 0, "width": 3, "height": 2},
      "data_source": {
        "type": "fabric_monitoring",
        "query": "PipelineRuns | where StartTime > ago(24h) | summarize SuccessRate = 100.0 * countif(Status == 'Succeeded') / count()"
      },
      "thresholds": {
        "good": 95,
        "warning": 90,
        "critical": 85
      }
    },
    {
      "id": "pipeline_duration_trend",
      "type": "line_chart",
      "title": "Pipeline Duration Trend",
      "position": {"x": 3, "y": 0, "width": 6, "height": 4},
      "data_source": {
        "type": "fabric_monitoring",
        "query": "PipelineRuns | where StartTime > ago(7d) | extend Duration = (EndTime - StartTime) / 1m | summarize AvgDuration = avg(Duration) by bin(StartTime, 1h), PipelineName"
      },
      "axes": {
        "x": "StartTime",
        "y": "AvgDuration",
        "series": "PipelineName"
      }
    },
    {
      "id": "active_pipelines",
      "type": "table",
      "title": "Currently Running Pipelines",
      "position": {"x": 9, "y": 0, "width": 3, "height": 4},
      "data_source": {
        "type": "fabric_monitoring",
        "query": "PipelineRuns | where Status == 'InProgress' | project PipelineName, StartTime, RunId | order by StartTime desc"
      }
    },
    {
      "id": "failed_pipelines",
      "type": "table",
      "title": "Recent Failed Pipelines",
      "position": {"x": 0, "y": 4, "width": 6, "height": 3},
      "data_source": {
        "type": "fabric_monitoring",
        "query": "PipelineRuns | where StartTime > ago(24h) and Status == 'Failed' | project PipelineName, StartTime, ErrorMessage | order by StartTime desc | take 10"
      },
      "alerts": {
        "enabled": true,
        "condition": "count > 0",
        "severity": "high"
      }
    },
    {
      "id": "pipeline_activity_breakdown",
      "type": "bar_chart",
      "title": "Pipeline Activity Breakdown",
      "position": {"x": 6, "y": 4, "width": 6, "height": 3},
      "data_source": {
        "type": "fabric_monitoring",
        "query": "PipelineRuns | where StartTime > ago(24h) | summarize Count = count() by Status"
      },
      "axes": {
        "x": "Status",
        "y": "Count"
      }
    },
    {
      "id": "streaming_lag",
      "type": "gauge",
      "title": "Streaming Lag (seconds)",
      "position": {"x": 0, "y": 7, "width": 3, "height": 2},
      "data_source": {
        "type": "kql",
        "database": "kql_insurance_realtime",
        "query": "streaming_lag() | project lag_seconds"
      },
      "thresholds": {
        "good": 10,
        "warning": 60,
        "critical": 300
      }
    },
    {
      "id": "data_quality_score",
      "type": "scorecard",
      "title": "Real-time Data Quality Score",
      "position": {"x": 3, "y": 7, "width": 3, "height": 2},
      "data_source": {
        "type": "kql",
        "database": "kql_insurance_realtime",
        "query": "realtime_data_quality() | project overall_dq_score"
      },
      "thresholds": {
        "good": 95,
        "warning": 90,
        "critical": 80
      }
    },
    {
      "id": "throughput_chart",
      "type": "area_chart",
      "title": "Streaming Throughput (events/min)",
      "position": {"x": 6, "y": 7, "width": 6, "height": 4},
      "data_source": {
        "type": "kql",
        "database": "kql_insurance_realtime",
        "query": "realtime_claims_events | where ingestion_time > ago(1h) | summarize count() by bin(ingestion_time, 1m)"
      },
      "axes": {
        "x": "ingestion_time",
        "y": "count_"
      }
    }
  ],
  "filters": [
    {
      "id": "time_range",
      "type": "time_range_picker",
      "default": "24h",
      "options": ["1h", "6h", "24h", "7d", "30d"]
    },
    {
      "id": "pipeline_name",
      "type": "dropdown",
      "label": "Pipeline",
      "data_source": "PipelineRuns | distinct PipelineName"
    }
  ]
}
