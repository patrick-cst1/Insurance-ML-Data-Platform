{
  "name": "Data Quality Dashboard",
  "description": "Monitor data quality metrics across all Medallion layers",
  "refresh_interval": "15m",
  "widgets": [
    {
      "id": "overall_dq_score",
      "type": "scorecard",
      "title": "Overall DQ Score",
      "position": {"x": 0, "y": 0, "width": 3, "height": 2},
      "data_source": {
        "type": "delta",
        "lakehouse": "lh_silver",
        "table": "dq_check_results",
        "query": "SELECT AVG(CASE WHEN overall_passed THEN 100 ELSE 0 END) as dq_score FROM dq_check_results WHERE check_timestamp > current_timestamp() - INTERVAL 24 HOURS"
      },
      "thresholds": {
        "good": 95,
        "warning": 90,
        "critical": 80
      }
    },
    {
      "id": "dq_trend",
      "type": "line_chart",
      "title": "Data Quality Trend (7 days)",
      "position": {"x": 3, "y": 0, "width": 6, "height": 4},
      "data_source": {
        "type": "delta",
        "lakehouse": "lh_silver",
        "table": "dq_check_results",
        "query": "SELECT DATE_TRUNC('hour', check_timestamp) as time, table_name, AVG(CASE WHEN overall_passed THEN 100 ELSE 0 END) as dq_score FROM dq_check_results WHERE check_timestamp > current_timestamp() - INTERVAL 7 DAYS GROUP BY 1, 2 ORDER BY 1"
      },
      "axes": {
        "x": "time",
        "y": "dq_score",
        "series": "table_name"
      }
    },
    {
      "id": "table_health_status",
      "type": "table",
      "title": "Table Health Status",
      "position": {"x": 9, "y": 0, "width": 3, "height": 4},
      "data_source": {
        "type": "delta",
        "lakehouse": "lh_silver",
        "table": "dq_check_results",
        "query": "SELECT table_name, record_count, CASE WHEN overall_passed THEN '✓ PASS' ELSE '✗ FAIL' END as status, check_timestamp FROM dq_check_results WHERE check_timestamp = (SELECT MAX(check_timestamp) FROM dq_check_results) ORDER BY overall_passed ASC, table_name"
      },
      "formatting": {
        "status": {
          "type": "conditional",
          "rules": [
            {"value": "✓ PASS", "color": "green"},
            {"value": "✗ FAIL", "color": "red"}
          ]
        }
      }
    },
    {
      "id": "null_violations",
      "type": "bar_chart",
      "title": "Null Check Violations by Table",
      "position": {"x": 0, "y": 4, "width": 6, "height": 3},
      "data_source": {
        "type": "delta",
        "lakehouse": "lh_silver",
        "table": "dq_check_results",
        "query": "SELECT table_name, SUM(CASE WHEN null_check = false THEN 1 ELSE 0 END) as violations FROM dq_check_results WHERE check_timestamp > current_timestamp() - INTERVAL 24 HOURS GROUP BY table_name"
      },
      "axes": {
        "x": "table_name",
        "y": "violations"
      }
    },
    {
      "id": "duplicate_violations",
      "type": "bar_chart",
      "title": "Duplicate Check Violations by Table",
      "position": {"x": 6, "y": 4, "width": 6, "height": 3},
      "data_source": {
        "type": "delta",
        "lakehouse": "lh_silver",
        "table": "dq_check_results",
        "query": "SELECT table_name, SUM(CASE WHEN duplicate_check = false THEN 1 ELSE 0 END) as violations FROM dq_check_results WHERE check_timestamp > current_timestamp() - INTERVAL 24 HOURS GROUP BY table_name"
      },
      "axes": {
        "x": "table_name",
        "y": "violations"
      }
    },
    {
      "id": "freshness_status",
      "type": "heatmap",
      "title": "Data Freshness Heatmap",
      "position": {"x": 0, "y": 7, "width": 6, "height": 3},
      "data_source": {
        "type": "delta",
        "lakehouse": "lh_silver",
        "table": "dq_check_results",
        "query": "SELECT table_name, DATE_TRUNC('day', check_timestamp) as day, AVG(CASE WHEN freshness_check THEN 1 ELSE 0 END) as freshness_score FROM dq_check_results WHERE check_timestamp > current_timestamp() - INTERVAL 30 DAYS GROUP BY 1, 2"
      },
      "axes": {
        "x": "day",
        "y": "table_name",
        "value": "freshness_score"
      }
    },
    {
      "id": "recent_failures",
      "type": "table",
      "title": "Recent DQ Failures",
      "position": {"x": 6, "y": 7, "width": 6, "height": 3},
      "data_source": {
        "type": "delta",
        "lakehouse": "lh_silver",
        "table": "dq_check_results",
        "query": "SELECT table_name, check_timestamp, CASE WHEN NOT duplicate_check THEN 'Duplicates' WHEN NOT null_check THEN 'Nulls' WHEN NOT freshness_check THEN 'Freshness' ELSE 'Other' END as failure_type FROM dq_check_results WHERE overall_passed = false ORDER BY check_timestamp DESC LIMIT 20"
      },
      "alerts": {
        "enabled": true,
        "condition": "count > 0",
        "severity": "medium"
      }
    },
    {
      "id": "record_count_trend",
      "type": "area_chart",
      "title": "Record Count Trend by Table",
      "position": {"x": 0, "y": 10, "width": 12, "height": 3},
      "data_source": {
        "type": "delta",
        "lakehouse": "lh_silver",
        "table": "dq_check_results",
        "query": "SELECT DATE_TRUNC('hour', check_timestamp) as time, table_name, AVG(record_count) as avg_records FROM dq_check_results WHERE check_timestamp > current_timestamp() - INTERVAL 7 DAYS GROUP BY 1, 2 ORDER BY 1"
      },
      "axes": {
        "x": "time",
        "y": "avg_records",
        "series": "table_name"
      }
    }
  ],
  "filters": [
    {
      "id": "time_range",
      "type": "time_range_picker",
      "default": "24h",
      "options": ["6h", "24h", "7d", "30d"]
    },
    {
      "id": "table_filter",
      "type": "multi_select",
      "label": "Tables",
      "data_source": "SELECT DISTINCT table_name FROM dq_check_results"
    },
    {
      "id": "status_filter",
      "type": "dropdown",
      "label": "Status",
      "options": ["All", "Passed", "Failed"],
      "default": "All"
    }
  ],
  "alerts": [
    {
      "name": "Critical DQ Failure",
      "condition": "overall_dq_score < 80",
      "severity": "critical",
      "notification_channels": ["email", "teams"]
    },
    {
      "name": "DQ Score Warning",
      "condition": "overall_dq_score < 90",
      "severity": "warning",
      "notification_channels": ["teams"]
    }
  ]
}
